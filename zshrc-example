# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Path to your Oh My Zsh installation.
export ZSH="$HOME/.oh-my-zsh"

# Set name of the theme to load
ZSH_THEME="powerlevel10k/powerlevel10k"

# Which plugins would you like to load?
plugins=(
  git              # Git commands and aliases
  zsh-syntax-highlighting
  zsh-autosuggestions
  zsh-completions
  tmux
  fzf
  history          # Enhanced history search
  aliases          # Useful command aliases
)

source $ZSH/oh-my-zsh.sh

# User configuration
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=244'

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR='vim'
else
  export EDITOR='nvim'
fi

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Enable fzf-tab
source ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/fzf-tab/fzf-tab.plugin.zsh

# Customize fzf-tab behavior
zstyle ':fzf-tab:*' fzf-preview ''
zstyle ':fzf-tab:*' fzf-multi true

HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000

setopt appendhistory       # Append history instead of overwriting
setopt sharehistory        # Share history between sessions
setopt incappendhistory    # Save history incrementally
setopt hist_ignore_dups    # Ignore duplicate commands
setopt hist_reduce_blanks  # Remove extra blanks from commands

# disable sort when completing `git checkout`
zstyle ':completion:*:git-checkout:*' sort false
# set descriptions format to enable group support
zstyle ':completion:*:descriptions' format '[%d]'
# set list-colors to enable filename colorizing
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# force zsh not to show completion menu, which allows fzf-tab to capture the unambiguous prefix
zstyle ':completion:*' menu no
# preview directory's content with eza when completing cd
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --color=always $realpath'
# custom fzf flags
zstyle ':fzf-tab:*' fzf-flags --color=fg:1,fg+:2 --bind=tab:accept
# To make fzf-tab follow FZF_DEFAULT_OPTS.
zstyle ':fzf-tab:*' use-fzf-default-opts yes
# switch group using `<` and `>`
zstyle ':fzf-tab:*' switch-group '<' '>'
zstyle ':fzf-tab:*' popup-min-size 120
zstyle ':fzf-tab:*' fzf-command ftb-tmux-popup

# ============================================================================
# TMUX LAYOUT ALIASES
# ============================================================================

# Two stacked on left, full horizontal on the right (log view)
alias tlay-focus='tmux rename-window focus; tmux split-window -h -l 35%; tmux select-pane -L; tmux split-window -v -l 30%; tmux select-pane -L'

# 2x2 equal grid
alias tlay-grid='tmux rename-window grid; tmux split-window -h; tmux split-window -v; tmux select-pane -L; tmux split-window -v'

# Top wide, two bottom panes
alias tlay-wide='tmux rename-window wide; tmux split-window -v -l 50%; tmux split-window -h'

# Simple vertical split 55/45
alias tlay-v55='tmux rename-window 55/45; tmux split-window -h -l 45%'

# Full horizontal on the left (claude view), two stack on the right (code view 7/3), 2 windows for services
alias tlay-mobile='
  tmux rename-window claude.ai \; \
    new-window -n nvim \; \
    new-window -n testing \; \
    new-window -n services \; \
    split-window -h -l 50% \; \
    select-window -t 1
'

# Full horizontal on the left (claude view), two stack on the right (code view 7/3), 1 split vertical stack window for services
alias tlay-desk='
  tmux rename-window code \; \
    split-window -h -l 35% \; \
    select-pane -L \; \
    split-window -v -l 30% \; \
    select-pane -L \; \
    new-window -n services \; \
    split-window -h -l 50% \; \
    select-window -t 1
'

# Reset All tmux panes and windows
alias tlay-reset='
    tmux kill-pane -a \; \
     kill-window -a
'

# Activate default virtual environment
alias vact="source .venv/bin/activate"

# ============================================================================
# PATH AND ENVIRONMENT
# ============================================================================

export PATH="$PATH:/usr/local/bin:$HOME/.local/bin:/usr/local/opt"

# NVM (Node Version Manager) - uncomment if using nvm
# export NVM_DIR="$HOME/.nvm"
# [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
# [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
